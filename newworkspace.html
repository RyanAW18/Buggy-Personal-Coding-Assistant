<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>HTML</title>
    <style>
        ul.top_nav {
                list-style-type: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #212b3d;
            }
        #company {
                left: 49%;
                position: absolute;
            }
        #nav_item {
                float: right;
            }
        #nav_items {
                float: left;
            }

        li.other a, .dropbtn {
            display: inline-block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        li.other a:hover, .dropdown:hover .dropbtn {
                background-color: gray;
            }

        li.dropdown {
            display: inline-block;
        }

        .dropdown-content {
                display: none;
                position: absolute;
                background-color: #f9f9f9;
                min-width: 160px;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                z-index: 1;
            }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
        }

        .dropdown-content a:hover {background-color: #f1f1f1}

            .dropdown:hover .dropdown-content {
                display: block;
            }

            ul.bottom_nav {
                list-style-type: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
                background-color: #212b3d;
                bottom: 0;
                width: 100%;
                height:6%;
            }


            .dropdown-content a:hover {background-color: #f1f1f1}

            .dropdown:hover .dropdown-content {
                display: block;
            }

            li.tool {
                float: left;
            }

            li.tool a {
                display: block;
                color: white;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
                
            }

            li.tool a:hover {
                background-color: gray;
            }

            html, body {
                height: 100%;
                margin: 0;
            }
            div {
                height: 100%;
            }

        #editor {
                position: absolute;
                top: 0;
                right: 45%;
                bottom: 5%;
                left: 0;
            }
            #logout {
                position: absolute;
                top: 95%;
                right: 45%;
                bottom: ;
                left: 0;
            }
        #snippet {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 45%;
            left: 55%;
            background-color: white;
        }
        #terminal {
            position: absolute;
            top: 60%;
            right: 0;
            bottom: 0;
            left: 55%;
            background-color: black;
            color: white;
        }
        #terminalBox {
            position: absolute;
            top: 92%;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: black;
            color: white;
        }

        </style>
</head>
<body>
<header id="header" class="clearfix" data-current-skin="blue">
            <ul class="header-inner">
                <li id="menu-trigger" data-trigger="#sidebar">
                    <div class="line-wrap">
                        <div class="line top"></div>
                        <div class="line center"></div>
                        <div class="line bottom"></div>
                    </div>
                </li>

                <li class="logo hidden-xs">
                    <a href="index.html">Material Admin</a>
                </li>

                <li class="pull-right">
                    <ul class="top-menu">
                        <li id="toggle-width">
                            <div class="toggle-switch">
                                <input id="tw-switch" type="checkbox" hidden="hidden">
                                <label for="tw-switch" class="ts-helper"></label>
                            </div>
                        </li>

                        <li id="top-search">
                            <a href=""><i class="tm-icon zmdi zmdi-search"></i></a>
                        </li>

                        <li class="dropdown">
                            <a data-toggle="dropdown" href="">
                                <i class="tm-icon zmdi zmdi-email"></i>
                                <i class="tmn-counts">6</i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-lg pull-right">
                                <div class="listview">
                                    <div class="lv-header">
                                        Messages
                                    </div>
                                    <div class="lv-body">
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/1.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">David Belle</div>
                                                    <small class="lv-small">Cum sociis natoque penatibus et magnis dis parturient montes</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/2.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Jonathan Morris</div>
                                                    <small class="lv-small">Nunc quis diam diamurabitur at dolor elementum, dictum turpis vel</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/3.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Fredric Mitchell Jr.</div>
                                                    <small class="lv-small">Phasellus a ante et est ornare accumsan at vel magnauis blandit turpis at augue ultricies</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/4.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Glenn Jecobs</div>
                                                    <small class="lv-small">Ut vitae lacus sem ellentesque maximus, nunc sit amet varius dignissim, dui est consectetur neque</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/4.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Bill Phillips</div>
                                                    <small class="lv-small">Proin laoreet commodo eros id faucibus. Donec ligula quam, imperdiet vel ante placerat</small>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <a class="lv-footer" href="">View All</a>
                                </div>
                            </div>
                        </li>
                        <li class="dropdown">
                            <a data-toggle="dropdown" href="">
                                <i class="tm-icon zmdi zmdi-notifications"></i>
                                <i class="tmn-counts">9</i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-lg pull-right">
                                <div class="listview" id="notifications">
                                    <div class="lv-header">
                                        Notification

                                        <ul class="actions">
                                            <li class="dropdown">
                                                <a href="" data-clear="notification">
                                                    <i class="zmdi zmdi-check-all"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="lv-body">
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/1.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">David Belle</div>
                                                    <small class="lv-small">Cum sociis natoque penatibus et magnis dis parturient montes</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/2.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Jonathan Morris</div>
                                                    <small class="lv-small">Nunc quis diam diamurabitur at dolor elementum, dictum turpis vel</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/3.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Fredric Mitchell Jr.</div>
                                                    <small class="lv-small">Phasellus a ante et est ornare accumsan at vel magnauis blandit turpis at augue ultricies</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/4.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Glenn Jecobs</div>
                                                    <small class="lv-small">Ut vitae lacus sem ellentesque maximus, nunc sit amet varius dignissim, dui est consectetur neque</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/4.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">Bill Phillips</div>
                                                    <small class="lv-small">Proin laoreet commodo eros id faucibus. Donec ligula quam, imperdiet vel ante placerat</small>
                                                </div>
                                            </div>
                                        </a>
                                    </div>

                                    <a class="lv-footer" href="">View Previous</a>
                                </div>

                            </div>
                        </li>
                        <li class="dropdown hidden-xs">
                            <a data-toggle="dropdown" href="">
                                <i class="tm-icon zmdi zmdi-view-list-alt"></i>
                                <i class="tmn-counts">2</i>
                            </a>
                            <div class="dropdown-menu pull-right dropdown-menu-lg">
                                <div class="listview">
                                    <div class="lv-header">
                                        Tasks
                                    </div>
                                    <div class="lv-body">
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">HTML5 Validation Report</div>

                                            <div class="progress">
                                                <div class="progress-bar" role="progressbar" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100" style="width: 95%">
                                                    <span class="sr-only">95% Complete (success)</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Google Chrome Extension</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                                    <span class="sr-only">80% Complete (success)</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Social Intranet Projects</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                                    <span class="sr-only">20% Complete</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Bootstrap Admin Template</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                                    <span class="sr-only">60% Complete (warning)</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Youtube Client App</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                                    <span class="sr-only">80% Complete (danger)</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <a class="lv-footer" href="">View All</a>
                                </div>
                            </div>
                        </li>
                        <li class="dropdown">
                            <a data-toggle="dropdown" href=""><i class="tm-icon zmdi zmdi-more-vert"></i></a>
                            <ul class="dropdown-menu dm-icon pull-right">
                                <li class="skin-switch hidden-xs">
                                    <span class="ss-skin bgm-lightblue" data-skin="lightblue"></span>
                                    <span class="ss-skin bgm-bluegray" data-skin="bluegray"></span>
                                    <span class="ss-skin bgm-cyan" data-skin="cyan"></span>
                                    <span class="ss-skin bgm-teal" data-skin="teal"></span>
                                    <span class="ss-skin bgm-orange" data-skin="orange"></span>
                                    <span class="ss-skin bgm-blue" data-skin="blue"></span>
                                </li>
                                <li class="divider hidden-xs"></li>
                                <li class="hidden-xs">
                                    <a data-action="fullscreen" href=""><i class="zmdi zmdi-fullscreen"></i> Toggle Fullscreen</a>
                                </li>
                                <li>
                                    <a data-action="clear-localstorage" href=""><i class="zmdi zmdi-delete"></i> Clear Local Storage</a>
                                </li>
                                <li>
                                    <a href=""><i class="zmdi zmdi-face"></i> Privacy Settings</a>
                                </li>
                                <li>
                                    <a href=""><i class="zmdi zmdi-settings"></i> Other Settings</a>
                                </li>
                            </ul>
                        </li>
                        <li class="hidden-xs" id="chat-trigger" data-trigger="#chat">
                            <a href=""><i class="tm-icon zmdi zmdi-comment-alt-text"></i></a>
                        </li>
                    </ul>
                </li>
            </ul>


            <!-- Top Search Content -->
            <div id="top-search-wrap">
                <div class="tsw-inner">
                    <i id="top-search-close" class="zmdi zmdi-arrow-left"></i>
                    <input type="text">
                </div>
            </div>
        </header>
  <div class="container">

        <div id="editor" class="col-md-6"></div>
        <a href="http://127.0.0.1:8081/!" id="logout">Log Out</a>
       <pre id="snippet" class="col-md-6">
       </pre>
       <div id="terminal">
       </div>
       <script src="/socket.io/socket.io.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
        <script>
          /************************************* Setting Up editor ***********************************************************/
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/cobalt");
            editor.getSession().setMode("ace/mode/python");

        /************************************** Socket Setup ***************************************************************/

              var socket = io();

               socket.on('reply', function(data){
                document.getElementById("snippet").innerHTML += data.response + '<br>';
               });

               socket.on('opened', function(data){
                editor.setValue(data.file, -1)
                editor.navigateFileEnd()
               });

               socket.on('executionresults', function(data){
                document.getElementById("terminal").innerHTML += data.response + '<br>';
               });

               socket.on('welcome', function(data){
                document.getElementById("snippet").innerHTML += data.message + '<br>';
               });

               socket.on('downloadableFile', function(data){
                var elem = document.createElement('a');
                elem.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(data.content));
                elem.setAttribute('download', data.name+ ".py");
                elem.style.display = 'none';
                document.body.appendChild(elem);
                elem.click();
                document.body.removeChild(element);
               });

        /**************************************** Running Code on the Client Side ******************************************/

            // output functions are configurable.  This one just appends some text
            // to a pre element.
            function outf(text) { 
                var mypre = document.getElementById("output"); 
                mypre.innerHTML = mypre.innerHTML + text; 
            } 
            function builtinRead(x) {
                if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
                        throw "File not found: '" + x + "'";
                return Sk.builtinFiles["files"][x];
            }
            // Here's everything you need to run a python program in skulpt
            // grab the code from your textarea
            // get a reference to your pre element for output
            // configure the output function
            // call Sk.importMainWithBody()
            function runit(code) { 
               var prog = code;
               var mypre = document.getElementById("output"); 
               mypre.innerHTML = ''; 
               Sk.pre = "output";
               Sk.configure({output:outf, read:builtinRead}); 
               (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
               var myPromise = Sk.misceval.asyncToPromise(function() {
                   return Sk.importMainWithBody("<stdin>", false, prog, true);
               });
               myPromise.then(function(mod) {
                   console.log('success');
               },
                   function(err) {
                   console.log(err.toString());
               });
            } 

        /****************************************  Compiler ****************************************************************/

                var listening = false
                var compiler = function(data, editor){
                var messages = data.split(" ");
                for (i = 0; i < messages.length; i++){
                  if ((messages[i] == 'buggy') && ((i + 2) < messages.length)){
                    if ((messages[i+1] == "start") && (messages[i+2] == 'listening')){
                      listening = true;
                      break;
                    }
                    else if ((messages[i+1] == "stop") && (messages[i+2] == 'listening')){
                      listening = false;
                      break;
                    }
                    else if (messages[i+1] == "search") {
                      var query = "";
                      for (j = i + 1; j < messages.length; j++){
                        query += messages[j] + ' ';
                      }
                      document.getElementById("snippet").innerHTML+=query + '<br>';
                      socket.emit('search', {message: query});
                      break;
                    }
                    else if ((messages[i+1] == "please") && (messages[i+2] == "run")) {
                      var text = editor.getValue();
                      document.getElementById("terminal").innerHTML += "Executing code:" + '<br>';
                      runit(text)
                      break;
                    }
                    else if ((((messages[i+1] == "save") && (messages[i+2] == 'file')) && (messages[i+3] == 'as')) && (messages.length >= 5)) {
                      var fileContent = editor.getValue();
                      var filename = messages[i+4]
                      var user = "luffy"
                      socket.emit('saveFile', {content: fileContent, username: user, name: filename});
                      break;
                    }
                    else if ((((messages[i+1] == "delete") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
                      var filename = messages[i+4]
                      var user = "luffy"
                      socket.emit('deleteFile', {username: user, name: filename});
                      break;
                    }
                    else if ((((messages[i+1] == "download") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
                      var filename = messages[i+4]
                      var user = "luffy"
                      socket.emit('download', {username: user, name: filename});
                      break;
                    }
                    else if ((((messages[i+1] == "open") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
                      var filename = messages[i+4]
                      var user = "luffy"
                      socket.emit('open', {username: user, name: filename});
                      break;
                    }
                  }
                  if (listening){
                    if (messages[i] == "quote"){
                      editor.insert("\"");
                    }
                    else if (messages[i] == "Focus") {
                      editor.focus();
                      }
                    else if (messages[i] == "star") {
                      editor.insert("*");
                    }
                    else if (messages[i] == "pound") {
                      editor.insert("#");
                    }
                    else if (messages[i] == "comma") {
                      editor.insert(",");
                    }
                    else if ((messages[i] == "new") || (messages[i] == "\n")) {
                      editor.insert("\n");
                    }
                    else if (messages[i] == "space"){
                      editor.insert(" ");
                    }
                    else if (messages[i] == "delete"){
                      editor.removeWordLeft();
                    }
                    else if (messages[i] == "clear") {
                      editor.removeToLineStart();
                    }
                    else if (messages[i] == "reset") {
                      editor.selectAll();
                      editor.removeLines();
                    }
                    else if ( (messages[i] == "move") || (messages[i] == "go") ) {       
                       if ((messages[i+1] == "upwards") || (messages[i+1] == "up")) {
                          editor.navigateUp(1);
                          i++;
                        }
                        else if ((messages[i+1] == "downwards") || (messages[i+1] == "down")){
                          editor.navigateDown(1);
                          i++;
                       }
                       else if (messages[i+1] == "left") {
                          editor.navigateWordLeft();
                          i++;
                       }
                       else if (messages[i+1] == "right") {
                          editor.navigateWordRight();
                          i++;
                       }
                       else if (messages[i+1] == "to") {
                          if (messages[i+2] == "start") {
                            editor.navigateFileStart();
                            i++;
                          }
                          else if (messages[i+2] == "end") {
                            editor.navigateFileEnd();
                            i++;
                          }
                          else if (messages[i+2] == "front") {
                            editor.navigateLineStart();
                            i++;
                          }
                          else if (messages[i+2] == "back") {
                            editor.navigateLineEnd();
                            i++;
                          }
                          else {
                            editor.insert("move to ");
                          }
                          i++;
                        }
                       else {
                          editor.insert(messages[i]+" ");
                        }
                      }
                    else if (messages[i] == "left") {
                       if (messages[i+1] == "curly") {
                          editor.insert("{");
                          i++;
                        }
                        else if (messages[i+1] == "paren") {
                          editor.insert("(");
                          i++;
                        }
                       else if (messages[i+1] == "bracket") {
                          editor.insert("[");
                          i++;
                       }
                      else {
                          editor.insert(messages[i]+' ');
                        }
                    }
                    else if (messages[i] == "right") {
                       if (messages[i+1] == "curly") {
                          editor.insert("}");
                          i++;
                        }
                        else if (messages[i+1] == "paren") {
                          editor.insert(")");
                          i++;
                       }
                       else if (messages[i+1] == "bracket") {
                          editor.insert("]");
                          i++;
                        }
                        else {
                          editor.insert(messages[i]+' ');
                        }
                    }
                    else{
                      editor.insert(messages[i]+' ');
                    }
                  }
                }
              }


            /************************************** HTML 5 Speech Recognition system *********************************/
              if (!('webkitSpeechRecognition' in window)) {
                upgrade();
              } else {
                var recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.onerror = function(event) { console.log("oops") }
                recognition.onend = function() { recognition.start() }
                recognition.onresult = function(event) {
                compiler(event.results[0][0].transcript, editor);
              };
            }
              console.log("Hello World")
              recognition.start()
        </script>
  </div>
</body>
</html>