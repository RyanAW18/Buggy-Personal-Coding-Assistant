doctype html
html
  head
    script(src='skultjs/skulpt.min.js', type='text/javascript')
    script(src='skultjs/skulpt-stdlib.js', type='text/javascript')
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css')
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js')
    script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js')
    style.
      ul.top_nav {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #212b3d;
      }
      #company {
      left: 49%;
      position: absolute;
      }
      #nav_item {
      float: right;
      }
      #nav_items {
      float: left;
      }
      li.other a, .dropbtn {
      display: inline-block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      }
      li.other a:hover, .dropdown:hover .dropbtn {
      background-color: gray;
      }
      li.dropdown {
      display: inline-block;
      }
      .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      }
      .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
      }
      .dropdown-content a:hover {background-color: #f1f1f1}
      .dropdown:hover .dropdown-content {
      display: block;
      }
      ul.bottom_nav {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #212b3d;
      bottom: 0;
      width: 100%;
      height:6%;
      }
      li.tool {
      float: left;
      }
      li.tool a {
      display: block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      }
      li.tool a:hover {
      background-color: gray;
      }
      html, body {
      height: 100%;
      margin: 0;
      }
      div {
      height: 100%;
      float: left;
      }
      pre {
        position: absolute
        height: auto;
        width:100%;
        overflow: auto;
        background-color: #eeeeee;
        word-break: normal !important;
        word-wrap: normal !important;
        white-space: pre !important;
      }
      #snippet {
      position: relative;
      width:calc(30% - 10px);
      margin: 5px;
      background-color: white;
      height:86.4%;
      color: black;
      box-sizing: border-box;
      }
      #center {
      margin: 5px;
      width: calc(40% - 10px);
      height:86.4%;
      }
      #terminal {
      position: relative;
      margin: 5px;
      width: calc(30% - 10px);
      background-color: white;
      height:86.4%;
      color: black;
      box-sizing: border-box;
      }
      body{
      background-color: #212b3d;
  body
    - var user_name = (username);
    ul.top_nav
      li#company.other
        a.navbar-left(href='#')
          img(src='login/buggy_logo.png', width='25', height='14')
      li#nav_item.other
        a(href='#about') Settings
      li#nav_items.other
        a(href='#news') BUGGY
    #snippet
      ul.nav.nav-pills.nav-justified
        li
          a#pills(data-toggle='pill', href='#files') My Files
        li.active
          a#pills(data-toggle='pill', href='#code_snippets_holder') Code Snippets
      .tab-content(style="position: absolute; display:block; width:100% !important; height:100% !important; padding:0;border-width:0")
        #code_snippets_holder.tab-pane.fade.in.active(style="position: absolute; width:100%; height:100%; overflow: auto")
          pre#code_snippets.tab-pane.fade.in.active(style='display:block; background-color: white; border: none').
        pre#files.tab-pane.fade(style='display:block; background-color: white; border: none')
          p  Show files Here 
    #center
    #terminal
      ul.nav.nav-pills.nav-justified
        li.active
          a#pills(data-toggle='pill', href='#code_execution') Code Execution
        li
          a#pills(data-toggle='pill', href='#buggy_documentation') Buggy Documentation
      .tab-content(style="position: absolute; display:block; width:100% !important; height:100% !important; padding:0;border-width:0")
        #code_execution.tab-pane.fade.in.active(style="position: absolute; width:100%; height:100%; overflow: auto")
          pre#output.tab-pane.fade.in.active(style='display:block; background-color: white; border: none').
        pre#buggy_documentation.tab-pane.fade(style='display:block; background-color: white; border: none')
          p Fill this with information on how to use buggy !!!!!!!!!!!!

    script(src='/socket.io/socket.io.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js', type='text/javascript', charset='utf-8')
    script(type='text/javascript').
      /************************************* Setting Up editor ***********************************************************/
      var editor = ace.edit("center");
      editor.setTheme("ace/theme/cobalt");
      editor.getSession().setMode("ace/mode/python");
      /************************************** Socket Setup ***************************************************************/
      var socket = io();
      socket.on('reply', function(data){
      document.getElementById("code_snippets").innerHTML += data.response + '\n';
      });
      socket.on('opened', function(data){
      editor.setValue(data.file, -1)
      editor.navigateFileEnd()
      });
      socket.on('executionresults', function(data){
      document.getElementById("terminal").innerHTML += data.response + '<br>';
      });
      socket.on('welcome', function(data){
      document.getElementById("code_snippets").innerHTML += data.message +  "#{user_name}!\n";
      });
      socket.on('downloadableFile', function(data){
      var elem = document.createElement('a');
      elem.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(data.content));
      elem.setAttribute('download', data.name+ ".py");
      elem.style.display = 'none';
      document.body.appendChild(elem);
      elem.click();
      document.body.removeChild(element);
      });
      /**************************************** Running Code on the Client Side ******************************************/
      // output functions are configurable.  This one just appends some text
      // to a pre element.
      function outf(text) {
      var mypre = document.getElementById("output");
      mypre.innerHTML = mypre.innerHTML + text;
      }
      function builtinRead(x) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
      throw "File not found: '" + x + "'";
      return Sk.builtinFiles["files"][x];
      }
      // Here's everything you need to run a python program in skulpt
      // grab the code from your textarea
      // get a reference to your pre element for output
      // configure the output function
      // call Sk.importMainWithBody()
      function runit(code) {
      var prog = code;
      var mypre = document.getElementById("output");
      Sk.pre = "output";
      Sk.configure({output:outf, read:builtinRead});
      (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
      var myPromise = Sk.misceval.asyncToPromise(function() {
      return Sk.importMainWithBody("<stdin>", false, prog, true);
      });
      myPromise.then(function(mod) {
      console.log('success');
      },
      function(err) {
      console.log(err.toString());
      });
      }
      /****************************************  Compiler ****************************************************************/
      var listening = false
      var compiler = function(data, editor){
      var messages = data.split(" ");
      for (i = 0; i < messages.length; i++){
      if ((messages[i] == 'buggy') && ((i + 2) < messages.length)){
      if ((messages[i+1] == "start") && (messages[i+2] == 'listening')){
      listening = true;
      break;
      }
      else if ((messages[i+1] == "stop") && (messages[i+2] == 'listening')){
      listening = false;
      break;
      }
      else if (messages[i+1] == "search") {
      var query = "";
      for (j = i + 1; j < messages.length; j++){
      query += messages[j] + ' ';
      }
      document.getElementById("code_snippets").innerHTML+=query + '<br>';
      socket.emit('search', {message: query});
      break;
      }
      else if ((messages[i+1] == "please") && (messages[i+2] == "run")) {
      var text = editor.getValue();
      document.getElementById("output").innerHTML += "Executing code:\n";
      runit(text)
      break;
      }
      else if ((((messages[i+1] == "save") && (messages[i+2] == 'file')) && (messages[i+3] == 'as')) && (messages.length >= 5)) {
      var fileContent = editor.getValue();
      var filename = messages[i+4]
      socket.emit('saveFile', {content: fileContent, username: "#{user_name}", name: filename});
      break;
      }
      else if ((((messages[i+1] == "delete") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
      var filename = messages[i+4]
      socket.emit('deleteFile', {username: "#{user_name}", name: filename});
      break;
      }
      else if ((((messages[i+1] == "download") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
      var filename = messages[i+4]
      socket.emit('download', {username: "#{user_name}", name: filename});
      break;
      }
      else if ((((messages[i+1] == "open") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
      var filename = messages[i+4]
      socket.emit('open', {username: "#{user_name}", name: filename});
      break;
      }
      }
      if (listening){
      if (messages[i] == "quote"){
      editor.insert("\"");
      }
      else if (messages[i] == "Focus") {
      editor.focus();
      }
      else if (messages[i] == "star") {
      editor.insert("*");
      }
      else if (messages[i] == "pound") {
      editor.insert("#");
      }
      else if (messages[i] == "comma") {
      editor.insert(",");
      }
      else if ((messages[i] == "new") || (messages[i] == "\\n")) {
      editor.insert("\\n");
      }
      else if (messages[i] == "space"){
      editor.insert(" ");
      }
      else if (messages[i] == "delete"){
      editor.removeWordLeft();
      }
      else if (messages[i] == "clear") {
      editor.removeToLineStart();
      }
      else if (messages[i] == "reset") {
      editor.selectAll();
      editor.removeLines();
      }
      else if ( (messages[i] == "move") || (messages[i] == "go") ) {
      if ((messages[i+1] == "upwards") || (messages[i+1] == "up")) {
      editor.navigateUp(1);
      i++;
      }
      else if ((messages[i+1] == "downwards") || (messages[i+1] == "down")){
      editor.navigateDown(1);
      i++;
      }
      else if (messages[i+1] == "left") {
      editor.navigateWordLeft();
      i++;
      }
      else if (messages[i+1] == "right") {
      editor.navigateWordRight();
      i++;
      }
      else if (messages[i+1] == "to") {
      if (messages[i+2] == "start") {
      editor.navigateFileStart();
      i++;
      }
      else if (messages[i+2] == "end") {
      editor.navigateFileEnd();
      i++;
      }
      else if (messages[i+2] == "front") {
      editor.navigateLineStart();
      i++;
      }
      else if (messages[i+2] == "back") {
      editor.navigateLineEnd();
      i++;
      }
      else {
      editor.insert("move to ");
      }
      i++;
      }
      else {
      editor.insert(messages[i]+" ");
      }
      }
      else if (messages[i] == "left") {
      if (messages[i+1] == "curly") {
      editor.insert("{");
      i++;
      }
      else if (messages[i+1] == "paren") {
      editor.insert("(");
      i++;
      }
      else if (messages[i+1] == "bracket") {
      editor.insert("[");
      i++;
      }
      else {
      editor.insert(messages[i]+' ');
      }
      }
      else if (messages[i] == "right") {
      if (messages[i+1] == "curly") {
      editor.insert("}");
      i++;
      }
      else if (messages[i+1] == "paren") {
      editor.insert(")");
      i++;
      }
      else if (messages[i+1] == "bracket") {
      editor.insert("]");
      i++;
      }
      else {
      editor.insert(messages[i]+' ');
      }
      }
      else{
      editor.insert(messages[i]+' ');
      }
      }
      }
      }
      /************************************** HTML 5 Speech Recognition system *********************************/
      if (!('webkitSpeechRecognition' in window)) {
      upgrade();
      } else {
      var recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.onerror = function(event) { console.log("oops") }
      recognition.onend = function() { recognition.start() }
      recognition.onresult = function(event) {
      compiler(event.results[0][0].transcript, editor);
      };
      }
      console.log("Hello World")
      recognition.start()
    ul.bottom_nav
      li.tool
        a(href='#home') Save
      li.tool
        a(href='#news') Run
      li.tool
        a(href='#contact') Download
      li.tool
        a(href='#about') Open
