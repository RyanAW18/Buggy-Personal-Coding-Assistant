<!DOCTYPE html>
<html>
  <head>
    <script src="skultjs/skulpt.min.js" type="text/javascript"></script>
    <script src="skultjs/skulpt-stdlib.js" type="text/javascript"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Buggy</title>
    
    <!-- Vendor CSS -->
    <link href="jquery/vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
    <link href="jquery/vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">
    <link href="jquery/vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
    <link href="jquery/vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css" rel="stylesheet">        
        
    <!-- CSS -->
    <link href="jquery/css/app.min.1.css" rel="stylesheet">
    <link href="jquery/css/app.min.2.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
      ul.top_nav {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #212b3d;
      }
      #company {
      left: 49%;
      position: absolute;
      }
      #nav_item {
      float: right;
      }
      #nav_items {
      float: left;
      }
      li.other a, .dropbtn {
      display: inline-block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      }
      li.other a:hover, .dropdown:hover .dropbtn {
      background-color: gray;
      }
      li.dropdown {
      display: inline-block;
      }
      .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      }
      .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: left;
      }
      .dropdown-content a:hover {background-color: #f1f1f1}
      .dropdown:hover .dropdown-content {
      display: block;
      }
      html, body {
      height: 100%;
      margin: 0;
      background-color: #212b3d;
      }
      pre {
        position: absolute
        height: 100%;
        width:100%;
        overflow: auto;
        background-color: #eeeeee;
        word-break: normal !important;
        word-wrap: normal !important;
        white-space: pre !important;
      }
      
      #snippet {
      position: relative;
      width:calc(45% - 10px);
      margin: 5px;
      background-color: white;
      height:100%;
      color: black;
      box-sizing: border-box;
      float:left;
      }
      #editor {
      position: relative;
      margin: 5px;
      width: calc(55% - 10px);
      height:100%;
      float: left
      }
      #center {
      position: absolute;
      width: 100%;
      height:100%;
      }
    </style>
  </head>
  <body>
    <ul class="top_nav">
      <li class="other" id="company"><a class="navbar-left" href="#"><img src="login/buggy_logo.png" width="25" height="14"></a></li>
      <li class="dropdown">
        <a data-toggle="dropdown" href="" aria-expanded="false"><i class="tm-icon zmdi zmdi-more-vert"></i></a>
        <ul class="dropdown-menu dm-icon pull-right">
            <li class="skin-switch hidden-xs">
                <span class="ss-skin bgm-lightblue" data-skin="lightblue"></span>
                <span class="ss-skin bgm-bluegray" data-skin="bluegray"></span>
                <span class="ss-skin bgm-cyan" data-skin="cyan"></span>
                <span class="ss-skin bgm-teal" data-skin="teal"></span>
                <span class="ss-skin bgm-orange" data-skin="orange"></span>
                <span class="ss-skin bgm-blue" data-skin="blue"></span>
            </li>
            <li class="divider hidden-xs"></li>
            <li class="hidden-xs">
                <a data-action="fullscreen" href=""><i class="zmdi zmdi-fullscreen"></i> Toggle Fullscreen</a>
            </li>
            <li>
                <a data-action="clear-localstorage" href=""><i class="zmdi zmdi-delete"></i> Clear Local Storage</a>
            </li>
            <li>
                <a href=""><i class="zmdi zmdi-face"></i> Privacy Settings</a>
            </li>
            <li>
                <a href=""><i class="zmdi zmdi-settings"></i> Other Settings</a>
            </li>
        </ul>
    </li>
      <li class="other" id="nav_items"><a href="#news">BUGGY</a></li>
    </ul>
    <div id="editor"><code id="center"></code></div>
    <div id="snippet">
      <ul class="nav nav-pills nav-justified">
        <li><a id="pills" data-toggle="pill" href="#files">My Files</a></li>
        <li class="active"><a id="pills" data-toggle="pill" href="#code_snippets_holder">Code Snippets</a></li>
        <li><a id="pills" data-toggle="pill" href="#code_execution">Code Execution</a></li>
        <li><a id="pills" data-toggle="pill" href="#buggy_documentation">Buggy Commands</a></li>
      </ul>
      <div class="tab-content" style="position: absolute; display:block; width:100% !important; height:100% !important; padding:0;border-width:0">
        <div class="tab-pane fade in active" id="code_snippets_holder" style="position: absolute; width:100%; height:100%; overflow: auto">
          <pre class="tab-pane fade in active" id="code_snippets" style="display:block; background-color: white; border: none"></pre>
        </div>
        <pre class="tab-pane fade" id="files" style="display:block; background-color: white; border: none">
          <p>Show files Here </p></pre>
        <div class="tab-pane fade" id="code_execution" style="position: absolute; width:100%; height:100%; overflow: auto">
          <pre class="tab-pane fade" id="output" style="display:block; background-color: white; border: none"></pre>
        </div>
        <pre class="tab-pane fade" id="buggy_documentation" style="display:block; background-color: white; border: none">p Fill this with information on how to use buggy !!!!!!!!!!!!
</pre>
      </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
       /************************************* Setting Up editor ***********************************************************/
       var editor = ace.edit("center");
       editor.setTheme("ace/theme/cobalt");
       editor.getSession().setMode("ace/mode/python");
       /************************************** Socket Setup ***************************************************************/
       var socket = io();
       socket.on('reply', function(data){
       document.getElementById("code_snippets").innerHTML += data.response + '\n';
       });
      
       socket.on('opened', function(data){
       editor.setValue(data.file, -1)
       editor.navigateFileEnd()
       });
      
       socket.on('executionresults', function(data){
       document.getElementById("terminal").innerHTML += data.response + '<br>';
       });
      
       socket.on('welcome', function(data){
       var user = ""+ ""
       console.log(user);
       document.getElementById("code_snippets").innerHTML += data.message +  user;
       });
      
       var clickFunctionality = function (data){
       socket.emit('open', {username: "", name: data})
      }
       socket.on('files', function(data){
       console.log(data.filename);
       var iDiv = document.createElement('div');
       iDiv.id = data.filename;
       iDiv.className = 'file';
       iDiv.innerHTML = data.filename; 
       document.getElementById('files').appendChild(iDiv);
       document.getElementById("test").onclick=clickFunctionality(data.filename);
      });
      
       socket.on('downloadableFile', function(data){
       var elem = document.createElement('a');
       elem.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(data.content));
       elem.setAttribute('download', data.name+ ".py");
       elem.style.display = 'none';
       document.body.appendChild(elem);
       elem.click();
       document.body.removeChild(element);
       });
       /**************************************** Running Code on the Client Side ******************************************/
       // output functions are configurable.  This one just appends some text
       // to a pre element.
       function outf(text) {
       var mypre = document.getElementById("output");
       mypre.innerHTML = mypre.innerHTML + text;
       }
       function builtinRead(x) {
       if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
       throw "File not found: '" + x + "'";
       return Sk.builtinFiles["files"][x];
       }
       // Here's everything you need to run a python program in skulpt
       // grab the code from your textarea
       // get a reference to your pre element for output
       // configure the output function
       // call Sk.importMainWithBody()
       function runit(code) {
       var prog = code;
       var mypre = document.getElementById("output");
       Sk.pre = "output";
       Sk.configure({output:outf, read:builtinRead});
       (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
       var myPromise = Sk.misceval.asyncToPromise(function() {
       return Sk.importMainWithBody("<stdin>", false, prog, true);
       });
       myPromise.then(function(mod) {
       console.log('success');
       },
       function(err) {
       console.log(err.toString());
       });
       }
       /****************************************  Compiler ****************************************************************/
       listening = false;
       socket.emit('getFiles', {username: ""});
       var compiler = function(data, editor){
      
             var messages = data.split(" ");
      
             for (i = 0; i < messages.length; i++){
               if ((messages[i] == 'buggy') && ((i + 2) < messages.length)){
                 if ((messages[i+1] == "start") && (messages[i+2] == 'listening')){
                   listening = true;
                   break;
                 }
                 else if ((messages[i+1] == "stop") && (messages[i+2] == 'listening')){
                   listening = false;
                   break;
                 }
                 else if (messages[i+1] == "search") {
                   var query = "";
                   for (j = i + 1; j < messages.length; j++){
                     query += messages[j] + ' ';
                   }
                   document.getElementById("snippet").innerHTML+=query + '<br>';
                   socket.emit('search', {message: query});
                   break;
                 }
                 else if ((messages[i+1] == "please") && (messages[i+2] == "run")) {
                   var text = editor.getValue();
                   document.getElementById("terminal").innerHTML += "Executing code:" + '<br>';
                   socket.emit('execute', {message: text});
                   break;
                 }
                 else if ((((messages[i+1] == "save") && (messages[i+2] == 'file')) && (messages[i+3] == 'as')) && (messages.length >= 5)) {
                   var fileContent = editor.getValue();
                   var filename = messages[i+4]
                   var user = ""
                   socket.emit('saveFile', {content: fileContent, username: user, name: filename});
                   break;
                 }
                 else if ((((messages[i+1] == "delete") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
                   var filename = messages[i+4]
                   var user = ""
                   socket.emit('deleteFile', {username: user, name: filename});
                   break;
                 }
                 else if ((((messages[i+1] == "download") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
                   var filename = messages[i+4]
                   var user = "";
                   socket.emit('download', {username: user , name: filename});
                   break;
                 }
                 else if ((((messages[i+1] == "open") && (messages[i+2] == 'file')) && (messages[i+3] == 'named')) && (messages.length >= 5)) {
                   var filename = messages[i+4]
                   var user = "";
                   socket.emit('open', {username: user, name: filename});
                   break;
                 }
               }
               if (listening){
                 if (messages[i] == "quote"){
                   editor.insert("\"");
                 }
                 else if (messages[i] == "Focus") {
                   editor.focus();
                   }
                 else if (messages[i] == "star") {
                   editor.insert("*");
                 }
                 else if (messages[i] == "pound") {
                   editor.insert("#");
                 }
                 else if (messages[i] == "comma") {
                   editor.insert(",");
                 }
                 else if ((messages[i] == "new") || (messages[i] == "\n")) {
                   editor.insert("\n");
                 }
                 else if (messages[i] == "space"){
                   editor.insert(" ");
                 }
                 else if (messages[i] == "delete"){
                   editor.removeWordLeft();
                 }
                 else if (messages[i] == "clear") {
                   editor.removeToLineStart();
                 }
                 else if (messages[i] == "reset") {
                   editor.selectAll();
                   editor.removeLines();
                 }
                 else if ( (messages[i] == "move") || (messages[i] == "go") ) {       
                    if ((messages[i+1] == "upwards") || (messages[i+1] == "up")) {
                       editor.navigateUp(1);
                       i++;
                     }
                     else if ((messages[i+1] == "downwards") || (messages[i+1] == "down")){
                       editor.navigateDown(1);
                       i++;
                    }
                    else if (messages[i+1] == "left") {
                       editor.navigateWordLeft();
                       i++;
                    }
                    else if (messages[i+1] == "right") {
                       editor.navigateWordRight();
                       i++;
                    }
                    else if (messages[i+1] == "to") {
                       if (messages[i+2] == "start") {
                         editor.navigateFileStart();
                         i++;
                       }
                       else if (messages[i+2] == "end") {
                         editor.navigateFileEnd();
                         i++;
                       }
                       else if (messages[i+2] == "front") {
                         editor.navigateLineStart();
                         i++;
                       }
                       else if (messages[i+2] == "back") {
                         editor.navigateLineEnd();
                         i++;
                       }
                       else {
                         editor.insert("move to ");
                       }
                       i++;
                     }
                    else {
                       editor.insert(messages[i]+" ");
                     }
                   }
                 else if (messages[i] == "left") {
                    if (messages[i+1] == "curly") {
                       editor.insert("{");
                       i++;
                     }
                     else if (messages[i+1] == "paren") {
                       editor.insert("(");
                       i++;
                     }
                    else if (messages[i+1] == "bracket") {
                       editor.insert("[");
                       i++;
                    }
                   else {
                       editor.insert(messages[i]+' ');
                     }
                 }
                 else if (messages[i] == "right") {
                    if (messages[i+1] == "curly") {
                       editor.insert("}");
                       i++;
                     }
                     else if (messages[i+1] == "paren") {
                       editor.insert(")");
                       i++;
                    }
                    else if (messages[i+1] == "bracket") {
                       editor.insert("]");
                       i++;
                     }
                     else {
                       editor.insert(messages[i]+' ');
                     }
                 }
                 else{
                   editor.insert(messages[i]+' ');
                 }
               }
             }
           }
      
      
           if (!('webkitSpeechRecognition' in window)) {
             upgrade();
           } else {
             var recognition = new webkitSpeechRecognition();
             recognition.continuous = false;
             recognition.interimResults = false;
             recognition.onerror = function(event) { console.log("oops") }
             recognition.onend = function() { recognition.start() }
             recognition.onresult = function(event) {
             compiler(event.results[0][0].transcript, editor);
           };
         }
           console.log("Hello World")
           recognition.start()
    </script>
  </body>
</html>